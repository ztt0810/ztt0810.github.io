<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ã€ç›®æ ‡æ£€æµ‹ç³»åˆ—ã€‘Faster-RCNNç½‘ç»œç»“æ„è§£è¯»ä¸ä»£ç åˆ†æ</title>
      <link href="2021/02/14/cv/faster-rcnn/"/>
      <url>2021/02/14/cv/faster-rcnn/</url>
      
        <content type="html"><![CDATA[<h1 id="ã€ç›®æ ‡æ£€æµ‹ç³»åˆ—ã€‘Faster-RCNNç½‘ç»œç»“æ„è§£è¯»ä¸ä»£ç åˆ†æ"><a href="#ã€ç›®æ ‡æ£€æµ‹ç³»åˆ—ã€‘Faster-RCNNç½‘ç»œç»“æ„è§£è¯»ä¸ä»£ç åˆ†æ" class="headerlink" title="ã€ç›®æ ‡æ£€æµ‹ç³»åˆ—ã€‘Faster-RCNNç½‘ç»œç»“æ„è§£è¯»ä¸ä»£ç åˆ†æ"></a>ã€ç›®æ ‡æ£€æµ‹ç³»åˆ—ã€‘Faster-RCNNç½‘ç»œç»“æ„è§£è¯»ä¸ä»£ç åˆ†æ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç»è¿‡R-CNNå’ŒFast RCNNçš„ç§¯æ·€ï¼Œç”±ä½•å‡¯æ˜å¤§ç¥æå‡ºçš„Faster-RCNNï¼Œå°†ç‰¹å¾æå–ï¼ˆfeature extractionï¼‰ï¼Œå€™é€‰æ¡†æå–ï¼ˆæ›¿ä»£äº†R-CNNä¸Fast RCNNä¸­æ¯”è¾ƒè€—æ—¶çš„<strong>Selective Search</strong>ï¼‰ï¼Œbboxå›å½’å’Œåˆ†ç±»éƒ½æ•´åˆåˆ°ä¸€ä¸ªç½‘ç»œä¸­ã€‚æ¨ç†ç¬¬ä¸€é˜¶æ®µå…ˆæ‰¾å‡ºå›¾ç‰‡ä¸­å¾…æ£€æµ‹ç‰©ä½“çš„anchorçŸ©å½¢æ¡†ï¼ˆå¯¹èƒŒæ™¯ã€å¾…æ£€æµ‹ç‰©ä½“è¿›è¡ŒäºŒåˆ†ç±»ï¼‰ï¼Œç¬¬äºŒé˜¶æ®µå¯¹anchoræ¡†å†…å¾…æ£€æµ‹ç‰©ä½“è¿›è¡Œåˆ†ç±»ã€‚æå¤§çš„æå‡äº†æ£€æµ‹çš„é€Ÿåº¦å’Œç²¾åº¦ã€‚æœ¬æ–‡å°†å¯¹<strong>Faster-RCNN</strong>çš„ç½‘ç»œç»“æ„è¿›è¡Œè§£è¯»å¹¶ç»“åˆ<a href="https://github.com/jwyang/faster-rcnn.pytorch">ä»£ç </a>è¿›è¡Œåˆ†æã€‚</p><h2 id="è¯¦è§£"><a href="#è¯¦è§£" class="headerlink" title="è¯¦è§£"></a>è¯¦è§£</h2><h3 id="æ•´ä½“ç»“æ„å›¾ï¼š"><a href="#æ•´ä½“ç»“æ„å›¾ï¼š" class="headerlink" title="æ•´ä½“ç»“æ„å›¾ï¼š"></a>æ•´ä½“ç»“æ„å›¾ï¼š</h3><p><img src="/2021/02/14/cv/faster-rcnn/v2-c0172be282021a1029f7b72b51079ffe_720w.jpg" alt="img"></p><h3 id="ç‰¹å¾æå–ç½‘ç»œï¼ˆBackbone"><a href="#ç‰¹å¾æå–ç½‘ç»œï¼ˆBackbone" class="headerlink" title="ç‰¹å¾æå–ç½‘ç»œï¼ˆBackbone)"></a>ç‰¹å¾æå–ç½‘ç»œï¼ˆBackbone)</h3><p>â€‹    Backboneåˆç§°éª¨å¹²ç½‘ç»œï¼Œç”¨äºå…±äº«å·ç§¯åŸºç¡€å±‚ï¼Œæå–ç‰¹å¾ï¼ˆfeature mapï¼‰ï¼Œç»™åé¢çš„RPNå’Œå…¨è¿æ¥å±‚ä½¿ç”¨ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„Backboneæœ‰ResNetç³»åˆ—ï¼ŒEfficientNetç³»åˆ—ï¼Œå¦‚æœå¯¹ç²¾åº¦çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¯ä»¥è€ƒè™‘è¿™ä¸¤ç±»ç½‘ç»œï¼Œå¦‚æœæ˜¯ç§»åŠ¨ç«¯å¯¹é€Ÿåº¦çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ä½¿ç”¨shuffleNetç³»åˆ—ï¼ŒmobileNetç³»åˆ—ï¼Œè¿˜æœ‰æœ€è¿‘æ–°å‡ºçš„<a href="https://github.com/DingXiaoH/RepVGG">RepVGG</a>ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p>â€‹    è€Œæœ¬æ–‡ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯vgg16ä½œä¸ºbackboneï¼Œç”±äºç¯‡å¹…çš„åŸå› ï¼Œä¸”ä¸åŒçš„backboneçš„å¤„ç†æ–¹å¼ä¼šæœ‰ç»†å¾®çš„å·®åˆ«ï¼Œå› æ­¤æœ¬æ–‡å¯¹äºvgg16çš„ç»†èŠ‚ä¸è¿›è¡Œå±•å¼€ï¼Œåç»­ä¼šæœ‰ä¸“é—¨çš„ç« èŠ‚ä»‹ç»backbone(æŒ–å‘)</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_init_modules</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">import</span> torchvision.models <span class="keyword">as</span> models</span><br><span class="line">    vgg = models.vgg16()</span><br><span class="line">   <span class="keyword">if</span> self.pretrained:</span><br><span class="line">        print(<span class="string">&quot;Loading pretrained weights from %s&quot;</span> %(self.model_path))</span><br><span class="line">        state_dict = torch.load(self.model_path)</span><br><span class="line">        vgg.load_state_dict(&#123;k:v <span class="keyword">for</span> k,v <span class="keyword">in</span> state_dict.items() <span class="keyword">if</span> k <span class="keyword">in</span> vgg.state_dict()&#125;)</span><br><span class="line"></span><br><span class="line">    vgg.classifier = nn.Sequential(*<span class="built_in">list</span>(vgg.classifier._modules.values())[:-<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># not using the last maxpool layer</span></span><br><span class="line">    self.RCNN_base = nn.Sequential(*<span class="built_in">list</span>(vgg.features._modules.values())[:-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>â€‹    ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½œè€…ä½¿ç”¨çš„æ˜¯torchvisionè‡ªå¸¦çš„modelsï¼Œå»æ‰äº†vgg16çš„æœ€åä¸€å±‚æ± åŒ–å±‚ï¼Œä¹Ÿå°±æ˜¯å»æ‰äº†é™é‡‡æ ·ï¼Œæˆ‘æƒ³åŸå› åº”è¯¥æ˜¯æƒ³æå–æ›´å¤šçš„å°å°ºåº¦ç‰¹å¾å§ğŸ˜„</p><h3 id="åŒºåŸŸæè®®ç½‘ç»œï¼ˆRegion-Proposal-Networkï¼‰"><a href="#åŒºåŸŸæè®®ç½‘ç»œï¼ˆRegion-Proposal-Networkï¼‰" class="headerlink" title="åŒºåŸŸæè®®ç½‘ç»œï¼ˆRegion Proposal Networkï¼‰"></a>åŒºåŸŸæè®®ç½‘ç»œï¼ˆRegion Proposal Networkï¼‰</h3><h4 id="ç½‘ç»œç»“æ„å›¾ï¼š"><a href="#ç½‘ç»œç»“æ„å›¾ï¼š" class="headerlink" title="ç½‘ç»œç»“æ„å›¾ï¼š"></a>ç½‘ç»œç»“æ„å›¾ï¼š</h4><p><img src="/2021/02/14/cv/faster-rcnn/v2-1908feeaba591d28bee3c4a754cca282_720w.jpg" alt="img"></p><p>â€‹    RPNå¯ä»¥è¯´æ˜¯Faster-RCNNçš„çµé­‚æ‰€åœ¨ï¼Œä¼ ç»Ÿçš„<strong>Selective Search</strong>è¯´ç™½äº†å°±æ˜¯ç©·ä¸¾ï¼Œç„¶åå¯¹æ¯ä¸ªåŒºåŸŸè¿›è¡Œæ‰“åˆ†ï¼Œå¾—åˆ°ä¸ground truthæœ€æ¥è¿‘çš„ç›®æ ‡ï¼Œç›¸å½“è€—æ—¶ã€‚è€ŒRPNçš„ç²¾å¦™ä¹‹å¤„å°±åœ¨äºä»–å‡­å€Ÿanchorç”Ÿæˆå€™é€‰æ¡†ï¼Œæ¥ç€é€šè¿‡softmaxåŒºåˆ«æ­£è´Ÿanchor, ç„¶åå¯¹æ­£æ ·æœ¬è¿›è¡Œ<strong>è¾¹ç•Œæ¡†å›å½’ï¼ˆBounding Box Regressionï¼‰</strong>ä»¥ä¿®æ­£anchorå¾—åˆ°ç²¾å‡†çš„æè®®æ¡†ï¼ˆproposalï¼‰åé¢ç”¨äºå¯¹æè®®æ¡†è¿›è¡Œç›®æ ‡åˆ†ç±»ã€‚</p><p>ï¼ˆçœ‹å®Œä¸€é•¿ä¸²æ¦‚å¿µï¼Œè„‘å­é‡Œå¿…å®šæ˜¯ä¸€å †é—®å·ï¼Œä»€ä¹ˆæ˜¯anchorï¼Ÿå®ƒé•¿å•¥æ ·ï¼Ÿå®ƒæ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Ÿä»€ä¹ˆæ˜¯è¾¹ç•Œæ¡†å›å½’ï¼Ÿï¼Ÿï¼Ÿæ­¤æ—¶å¿ƒä¸­ä¸€ä¸‡åªç¾Šé©¼è·¯è¿‡ã€‚æˆ‘è¯´åœåœï¼Œè¿™å°±ç»™ä½ è§£é‡ŠğŸ˜ï¼‰</p><h4 id="Anchor"><a href="#Anchor" class="headerlink" title="Anchor"></a>Anchor</h4><p>â€‹    å…¶å®anchorè·Ÿselective searchçš„ä½œç”¨æ˜¯å·®ä¸å¤šçš„ï¼Œä¹Ÿæ˜¯ä¸ºäº†å¾—åˆ°ä¸€å †å¯èƒ½åŒ…å«å¾…æ£€æµ‹ç›®æ ‡çš„bounding boxã€‚å®ƒå…·ä½“ä½œæ³•æ˜¯æŠŠæ¯ä¸ªç‰¹å¾ç‚¹æ˜ å°„å›åŸå›¾çš„æ„Ÿå—é‡çš„ä¸­å¿ƒç‚¹å½“æˆä¸€ä¸ªåŸºå‡†ç‚¹ï¼Œè¿™é‡Œé¢å°ä¼™ä¼´ä»¬è‚¯å®šä¼šæœ‰ç–‘æƒ‘ï¼Œç‰¹å¾ç‚¹è¯¥æ€ä¹ˆæ˜ å°„å›åŸå›¾å‘¢ï¼Ÿï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç¡®ï¼Œç‰¹å¾å›¾æ˜¯åŸå›¾ç»è¿‡å·ç§¯æ“ä½œåå¾—åˆ°çš„ï¼Œè€Œå·ç§¯å°±æ˜¯å·ç§¯æ ¸åœ¨å›¾ç‰‡çŸ©é˜µä¸Šè¿›è¡Œæ»‘åŠ¨çª—å£å¼éå†æ“ä½œï¼ŒåŸå›¾å—å·ç§¯æ ¸å½±å“çš„åŒºåŸŸè¢«ç§°ä¸ºæ„Ÿå—é‡ï¼Œå¦‚æœæˆ‘ä»¬æœ€åå¾—åˆ°çš„ç‰¹å¾å›¾å¼60*60çš„ï¼Œé‚£ä¹ˆåœ¨åŸå›¾ä¸Šä¹Ÿå°±å¯¹åº”äº†60ä¸ªæ„Ÿå—é‡ï¼Œæˆ‘ä»¬å°†æ„Ÿå—é‡çš„ä¸­å¿ƒä½œä¸ºanchorçš„åŸºå‡†ç‚¹ï¼Œæˆ‘ä»¬å‡è®¾ç¬¬ä¸€ä¸ªæ„Ÿå—é‡çš„ä¸­å¿ƒæ˜¯ï¼ˆ0ï¼Œ0ï¼‰ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªåŸºå‡†ç‚¹ï¼Œæ¥ä¸‹å»çš„åŸºå‡†ç‚¹éƒ½ä¸å‰ä¸€ä¸ªåŸºå‡†ç‚¹ç›¸éš”base_sizeä¸ªç‚¹ï¼ˆbase_sizeæŒ‡æ„Ÿå—é‡å¤§å°ï¼‰ï¼Œæ˜¾ç„¶æœ€åæˆ‘ä»¬ç”Ÿæˆäº†60ä¸ªåŸºå‡†ç‚¹ï¼Œç„¶åå›´ç»•è¿™60ä¸ªåŸºå‡†ç‚¹é€‰å–kä¸ªä¸åŒscaleã€aspect ratioçš„anchorã€‚è®ºæ–‡ä¸­3ä¸ªscaleï¼ˆä¸‰ç§é¢ç§¯{128^2ï¼Œ256^2ï¼Œ512^2}ï¼‰ï¼Œ3ä¸ªaspect ratio( ä¸‰ç§é•¿å®½æ¯”{1:1ï¼Œ1:2ï¼Œ2:1} )ï¼Œä¸‹å›¾æ˜¯ä»¥ä¸€ä¸ªåŸºå‡†ç‚¹ç”Ÿæˆçš„kï¼ˆk=9ï¼‰ä¸ªanchorï¼Œé‚£ä¹ˆå‰©ä¸‹çš„åŸºå‡†ç‚¹ä»¥æ­¤ç±»æ¨ã€‚</p><p><img src="/2021/02/14/cv/faster-rcnn/v2-9962c78b9963fc323ba04ffb80f0cd95_720w.png" alt="img"></p><h5 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enumerate_shifted_anchor</span>(<span class="params">base_anchor, base_size, width, height</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    function description: å‡å°‘ä¸å¿…è¦çš„å¦‚generate_base_anchorsçš„è®¡ç®—, è¾ƒå¤§çš„ç‰¹å¾å›¾çš„é”šæ¡†ç”Ÿæˆæ¨¡æ¿, ç”Ÿæˆé”šæ¡†çš„åˆé€‰æ¨¡æ¿å³æ»‘åŠ¨çª—å£</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param base_anchor: éœ€è¦reshapeçš„anchors</span></span><br><span class="line"><span class="string">    :param base_size: ç‰¹å¾å›¾çš„æ¯ä¸ªåƒç´ çš„æ„Ÿå—é‡å¤§å°</span></span><br><span class="line"><span class="string">    :param height: featuremapçš„é«˜åº¦</span></span><br><span class="line"><span class="string">    :param width: featuremapçš„å®½åº¦</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">        anchor: ç»´åº¦ä¸º:[width*height*k, 4]çš„å…ˆéªŒæ¡†(anchors)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># è®¡ç®—featuremapä¸­æ¯ä¸ªåƒç´ ç‚¹åœ¨åŸå›¾ä¸­æ„Ÿå—é‡ä¸Šçš„ä¸­å¿ƒç‚¹åæ ‡</span></span><br><span class="line">    shift_x = np.arange(<span class="number">0</span>, width * base_size, base_size)</span><br><span class="line">    shift_y = np.arange(<span class="number">0</span>, height * base_size, base_size)</span><br><span class="line">    shift_x, shift_y = np.meshgrid(shift_x, shift_y)</span><br><span class="line">    print(<span class="string">&#x27;shift_x: &#x27;</span>, shift_x.shape, <span class="string">&#x27;shift_y: &#x27;</span>, shift_y.shape)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># TODO æ„Ÿè§‰æœ€æ­£ç»Ÿçš„æ–¹æ³•è¿˜æ˜¯éå†ä¸­å¿ƒç‚¹</span></span><br><span class="line">    <span class="comment"># index = 0</span></span><br><span class="line">    <span class="comment"># for x in shift_x:</span></span><br><span class="line">    <span class="comment">#     for y in shift_y:</span></span><br><span class="line">    <span class="comment">#         anchors = generate_base_anchors(center_x=x, center_y=y)</span></span><br><span class="line">    <span class="comment">#         if index == 0:</span></span><br><span class="line">    <span class="comment">#             old_anchors = anchors</span></span><br><span class="line">    <span class="comment">#         else:</span></span><br><span class="line">    <span class="comment">#             anchors = np.concatenate((old_anchors, anchors), axis=0)</span></span><br><span class="line">    <span class="comment">#             old_anchors = anchors</span></span><br><span class="line">    <span class="comment">#         index += 1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># TODO ç›´æ¥åˆ©ç”¨broadcastè²Œä¼¼ä¹Ÿå¯ä»¥è¾¾åˆ°ç›®çš„</span></span><br><span class="line">    <span class="comment"># shift_x.ravel()è¡¨ç¤ºåŸåœ°å°†ä¸ºä¸€ç»´æ•°ç»„, shiftçš„ç»´åº¦ä¸º: [feature_stride, 4]</span></span><br><span class="line">    shift = np.stack((shift_x.ravel(), shift_y.ravel(), shift_x.ravel(), shift_y.ravel(),), axis=<span class="number">1</span>)</span><br><span class="line">    A = base_anchor.shape[<span class="number">0</span>]</span><br><span class="line">    K = shift.shape[<span class="number">0</span>]</span><br><span class="line">    anchor = base_anchor.reshape((<span class="number">1</span>, A, <span class="number">4</span>)) + shift.reshape((K, <span class="number">1</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æœ€åå†åˆæˆä¸ºæ‰€æœ‰çš„å…ˆéªŒæ¡†, ç›¸å½“äºå¯¹featuremapçš„æ¯ä¸ªåƒç´ ç‚¹éƒ½ç”Ÿæˆk(9)ä¸ªå…ˆéªŒæ¡†(anchors)</span></span><br><span class="line">    anchors = anchor.reshape((K * A, <span class="number">4</span>)).astype(np.float32)</span><br><span class="line">    print(<span class="string">&#x27;result: &#x27;</span>, anchors.shape)</span><br><span class="line">    <span class="keyword">return</span> anchors</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ±‚å‡ºæ„Ÿå—ç‚¹ä¸­å¿ƒå¯¹åº”åœ¨åŸå›¾ä¸­çš„åæ ‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shift_x = np.arange(<span class="number">0</span>, width * base_size, base_size)</span><br><span class="line">shift_y = np.arange(<span class="number">0</span>, height * base_size, base_size)</span><br><span class="line">shift_x, shift_y = np.meshgrid(shift_x, shift_y)</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬ç”Ÿæˆanchors</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shift = np.stack((shift_x.ravel(), shift_y.ravel(), shift_x.ravel(), shift_y.ravel(),), axis=<span class="number">1</span>)</span><br><span class="line">A = base_anchor.shape[<span class="number">0</span>]</span><br><span class="line">K = shift.shape[<span class="number">0</span>]</span><br><span class="line">anchor = base_anchor.reshape((<span class="number">1</span>, A, <span class="number">4</span>)) + shift.reshape((K, <span class="number">1</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åå†åˆæˆä¸ºæ‰€æœ‰çš„å…ˆéªŒæ¡†, ç›¸å½“äºå¯¹featuremapçš„æ¯ä¸ªåƒç´ ç‚¹éƒ½ç”Ÿæˆk(9)ä¸ªå…ˆéªŒæ¡†(anchors)</span></span><br><span class="line">anchors = anchor.reshape((K * A, <span class="number">4</span>)).astype(np.float32)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆbase_anchorï¼ˆä»¥ï¼ˆ0,0ï¼‰ä¸ºåŸºå‡†ç‚¹çš„ç¬¬ä¸€ç»„anchorï¼‰æ˜¯æ€ä¹ˆæ¥çš„å‘¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># Verify that we compute the same anchors as Shaoqing&#x27;s matlab implementation:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    &gt;&gt; load output/rpn_cachedir/faster_rcnn_VOC2007_ZF_stage1_rpn/anchors.mat</span></span><br><span class="line"><span class="comment">#    &gt;&gt; anchors</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    anchors =</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#       -83   -39   100    56</span></span><br><span class="line"><span class="comment">#      -175   -87   192   104</span></span><br><span class="line"><span class="comment">#      -359  -183   376   200</span></span><br><span class="line"><span class="comment">#       -55   -55    72    72</span></span><br><span class="line"><span class="comment">#      -119  -119   136   136</span></span><br><span class="line"><span class="comment">#      -247  -247   264   264</span></span><br><span class="line"><span class="comment">#       -35   -79    52    96</span></span><br><span class="line"><span class="comment">#       -79  -167    96   184</span></span><br><span class="line"><span class="comment">#      -167  -343   184   360</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#array([[ -83.,  -39.,  100.,   56.],</span></span><br><span class="line"><span class="comment">#       [-175.,  -87.,  192.,  104.],</span></span><br><span class="line"><span class="comment">#       [-359., -183.,  376.,  200.],</span></span><br><span class="line"><span class="comment">#       [ -55.,  -55.,   72.,   72.],</span></span><br><span class="line"><span class="comment">#       [-119., -119.,  136.,  136.],</span></span><br><span class="line"><span class="comment">#       [-247., -247.,  264.,  264.],</span></span><br><span class="line"><span class="comment">#       [ -35.,  -79.,   52.,   96.],</span></span><br><span class="line"><span class="comment">#       [ -79., -167.,   96.,  184.],</span></span><br><span class="line"><span class="comment">#       [-167., -343.,  184.,  360.]])</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    xrange          <span class="comment"># Python 2</span></span><br><span class="line"><span class="keyword">except</span> NameError:</span><br><span class="line">    xrange = <span class="built_in">range</span>  <span class="comment"># Python 3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_anchors</span>(<span class="params">base_size=<span class="number">16</span>, ratios=[<span class="number">0.5</span>, <span class="number">1</span>, <span class="number">2</span>],</span></span></span><br><span class="line"><span class="function"><span class="params">                     scales=<span class="number">2</span>**np.arange(<span class="params"><span class="number">3</span>, <span class="number">6</span></span>)</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Generate anchor (reference) windows by enumerating aspect ratios X</span></span><br><span class="line"><span class="string">    scales wrt a reference (0, 0, 15, 15) window.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    base_anchor = np.array([<span class="number">1</span>, <span class="number">1</span>, base_size, base_size]) - <span class="number">1</span></span><br><span class="line">    ratio_anchors = _ratio_enum(base_anchor, ratios)</span><br><span class="line">    print(<span class="string">f&#x27;ratio_anchors : <span class="subst">&#123;ratio_anchors&#125;</span>&#x27;</span>)</span><br><span class="line">    anchors = np.vstack([_scale_enum(ratio_anchors[i, :], scales)</span><br><span class="line">                         <span class="keyword">for</span> i <span class="keyword">in</span> xrange(ratio_anchors.shape[<span class="number">0</span>])])</span><br><span class="line">    <span class="keyword">return</span> anchors</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_whctrs</span>(<span class="params">anchor</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Return width, height, x center, and y center for an anchor (window).</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    w = anchor[<span class="number">2</span>] - anchor[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">    h = anchor[<span class="number">3</span>] - anchor[<span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">    x_ctr = anchor[<span class="number">0</span>] + <span class="number">0.5</span> * (w - <span class="number">1</span>)</span><br><span class="line">    y_ctr = anchor[<span class="number">1</span>] + <span class="number">0.5</span> * (h - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> w, h, x_ctr, y_ctr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_mkanchors</span>(<span class="params">ws, hs, x_ctr, y_ctr</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Given a vector of widths (ws) and heights (hs) around a center</span></span><br><span class="line"><span class="string">    (x_ctr, y_ctr), output a set of anchors (windows).</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    ws = ws[:, np.newaxis]</span><br><span class="line">    hs = hs[:, np.newaxis]</span><br><span class="line">    anchors = np.hstack((x_ctr - <span class="number">0.5</span> * (ws - <span class="number">1</span>),</span><br><span class="line">                         y_ctr - <span class="number">0.5</span> * (hs - <span class="number">1</span>),</span><br><span class="line">                         x_ctr + <span class="number">0.5</span> * (ws - <span class="number">1</span>),</span><br><span class="line">                         y_ctr + <span class="number">0.5</span> * (hs - <span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">return</span> anchors</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ratio_enum</span>(<span class="params">anchor, ratios</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Enumerate a set of anchors for each aspect ratio wrt an anchor.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    w, h, x_ctr, y_ctr = _whctrs(anchor)</span><br><span class="line">    size = w * h</span><br><span class="line">    size_ratios = size / ratios</span><br><span class="line">    print(<span class="string">f&#x27;size_ratios : <span class="subst">&#123;size_ratios&#125;</span>&#x27;</span>)</span><br><span class="line">    ws = np.<span class="built_in">round</span>(np.sqrt(size_ratios))</span><br><span class="line">    hs = np.<span class="built_in">round</span>(ws * ratios)</span><br><span class="line">    print(<span class="string">f&#x27;ws: <span class="subst">&#123;ws&#125;</span>, hs : <span class="subst">&#123;hs&#125;</span>&#x27;</span>)</span><br><span class="line">    anchors = _mkanchors(ws, hs, x_ctr, y_ctr)</span><br><span class="line">    <span class="keyword">return</span> anchors</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_scale_enum</span>(<span class="params">anchor, scales</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Enumerate a set of anchors for each scale wrt an anchor.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    w, h, x_ctr, y_ctr = _whctrs(anchor)</span><br><span class="line">    <span class="comment"># print(f&#x27;w, h, x_ctr, y_ctr in scale enum: &#123;w, h, x_ctr, y_ctr&#125;&#x27;)</span></span><br><span class="line">    print(<span class="string">f&#x27;scales: <span class="subst">&#123;scales&#125;</span>&#x27;</span>)</span><br><span class="line">    ws = w * scales</span><br><span class="line">    hs = h * scales</span><br><span class="line">    <span class="comment"># print(f&#x27;ws, hs : &#123;ws, hs&#125;&#x27;)</span></span><br><span class="line">    anchors = _mkanchors(ws, hs, x_ctr, y_ctr)</span><br><span class="line">    print(<span class="string">f&#x27;scaled anchor: <span class="subst">&#123;anchors&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> anchors</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    t = time.time()</span><br><span class="line">    all_anchors = generate_anchors()</span><br><span class="line">    print(<span class="string">f&#x27;generated anchor: <span class="subst">&#123;all_anchors&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹    ä¸Šé¢çš„ä»£ç ä¸­ generate_anchors ä¸»è¦è´Ÿè´£ç”Ÿæˆanchorï¼Œ_whctrsè´Ÿè´£å°†åæ ‡è½¬æ¢ä¸ºï¼ˆå®½ï¼Œé«˜ï¼Œä¸­å¿ƒç‚¹xåæ ‡ï¼Œä¸­å¿ƒç‚¹yåæ ‡ï¼‰ï¼Œ_mkanchorsè´Ÿè´£å°†åæ ‡è½¬æ¢ä¸ºï¼ˆå·¦ä¸Šxï¼Œå·¦ä¸Šyï¼Œå³ä¸‹xï¼Œå³ä¸‹yï¼‰ä¹Ÿå°±æ˜¯anchorçš„åæ ‡å½¢å¼ï¼Œ_ratio_enumæ˜¯æ ¹æ®è®¾ç½®çš„ratioï¼Œç”Ÿæˆä½äºåŒä¸€ä¸­å¿ƒç‚¹é¢ç§¯ç›¸ç­‰ä½†åæ ‡ä¸åŒanchorï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„åŒè‰²çŸ©å½¢ï¼Œè€Œ_scale_enumåˆ™æ˜¯ç”Ÿæˆï¼ŒåŒæ¯”ä¾‹ï¼Œä½†æ˜¯é¢ç§¯ä¸åŒçš„kç»„anchorï¼Œå¤§å°ç”±scaleå†³å®šï¼Œé¢ç§¯ä¸ºbase_size * scale.</p><p>åˆ°è¿™é‡Œï¼Œanchorçš„ç”Ÿæˆä¹Ÿå°±ç»“æŸäº†ã€‚</p><p>å¾—åˆ°äº†å…ˆéªŒæ¡†ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½ç­›é€‰å‡ºå«æœ‰ç›®æ ‡ç‰©ä½“çš„æ¡†å‘¢</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç®€å•çš„ç­›é€‰ä¸€ä¸‹ï¼Œå“ªäº›æ¡†åŒ…å«ç‰©ä½“ï¼Œå“ªäº›ä¸åŒ…å«ï¼Œä¸€ä¸ªæ¯”è¾ƒç›´è§‚çš„æ–¹æ³•å°±æ˜¯è®¡ç®—bounding boxå’Œgroud truth çš„äº¤å¹¶æ¯”ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸èƒ½çœ‹åˆ°çš„ä¸€ä¸ªåè¯<strong>IOU</strong></p><h4 id="IOU"><a href="#IOU" class="headerlink" title="IOU"></a>IOU</h4><p>IOUçš„å®šä¹‰æ˜¯bounding box ä¸ground truth çš„äº¤é›†ï¼Œæ¯”ä¸Šä»–ä¿©çš„å¹¶é›†ï¼Œä¸€èˆ¬æˆ‘ä»¬è®¾å®šå½“iouå¤§äº0.7åˆ™è®¤ä¸ºbounding box åŒ…å«äº†ç›®æ ‡ï¼Œå³ä¸ºæ­£ç±»ï¼Œå½“iouå°äº0.3æ—¶æˆ‘ä»¬åˆ™è®¤ä¸ºä»–æ˜¯ä¸€ä¸ªè´Ÿç±»ï¼Œæ„æ€æ˜¯ä¸åŒ…å«ç›®æ ‡ã€‚</p><p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a href="https://zhuanlan.zhihu.com/p/24916624">https://zhuanlan.zhihu.com/p/24916624</a></p><p><a href="https://zhuanlan.zhihu.com/p/82185598">https://zhuanlan.zhihu.com/p/82185598</a></p><p><a href="https://zhuanlan.zhihu.com/p/31426458">https://zhuanlan.zhihu.com/p/31426458</a></p><p><a href="https://zhuanlan.zhihu.com/p/102978748">https://zhuanlan.zhihu.com/p/102978748</a></p><p><a href="https://blog.csdn.net/cj1561435010/article/details/106649040">https://blog.csdn.net/cj1561435010/article/details/106649040</a></p>]]></content>
      
      
      <categories>
          
          <category> Computer Vision </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Computer Vision </tag>
            
            <tag> Object Detection </tag>
            
            <tag> Two Stage Algorithm </tag>
            
            <tag> anchor based </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitå¸¸ç”¨æ“ä½œåˆé›†</title>
      <link href="2021/02/13/tool_operation/git/"/>
      <url>2021/02/13/tool_operation/git/</url>
      
        <content type="html"><![CDATA[<h1 id="Gitå¸¸ç”¨æ“ä½œ"><a href="#Gitå¸¸ç”¨æ“ä½œ" class="headerlink" title="Gitå¸¸ç”¨æ“ä½œ"></a>Gitå¸¸ç”¨æ“ä½œ</h1><h2 id="æŸ¥çœ‹å½“å‰åˆ†æ”¯ï¼š"><a href="#æŸ¥çœ‹å½“å‰åˆ†æ”¯ï¼š" class="headerlink" title="æŸ¥çœ‹å½“å‰åˆ†æ”¯ï¼š"></a>æŸ¥çœ‹å½“å‰åˆ†æ”¯ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼š"><a href="#æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼š" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼š"></a>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°æœ¬åœ°åˆ†æ”¯ï¼š"><a href="#æ›´æ–°æœ¬åœ°åˆ†æ”¯ï¼š" class="headerlink" title="æ›´æ–°æœ¬åœ°åˆ†æ”¯ï¼š"></a>æ›´æ–°æœ¬åœ°åˆ†æ”¯ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote update origin --prune</span><br><span class="line">git fetch origin --prune    git branch -a</span><br></pre></td></tr></table></figure><h2 id="åˆ‡æ¢æœ¬åœ°åˆ†æ”¯ï¼ˆè‹¥åˆ†æ”¯åœ¨æœ¬åœ°æœªä¸orginåŒæ­¥ï¼‰ï¼š"><a href="#åˆ‡æ¢æœ¬åœ°åˆ†æ”¯ï¼ˆè‹¥åˆ†æ”¯åœ¨æœ¬åœ°æœªä¸orginåŒæ­¥ï¼‰ï¼š" class="headerlink" title="åˆ‡æ¢æœ¬åœ°åˆ†æ”¯ï¼ˆè‹¥åˆ†æ”¯åœ¨æœ¬åœ°æœªä¸orginåŒæ­¥ï¼‰ï¼š"></a>åˆ‡æ¢æœ¬åœ°åˆ†æ”¯ï¼ˆè‹¥åˆ†æ”¯åœ¨æœ¬åœ°æœªä¸orginåŒæ­¥ï¼‰ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b [branch name]</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š"><a href="#åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š" class="headerlink" title="åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š"></a>åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete [branch name]</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆdevåˆ†æ”¯ï¼‰ï¼š"><a href="#åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆdevåˆ†æ”¯ï¼‰ï¼š" class="headerlink" title="åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆdevåˆ†æ”¯ï¼‰ï¼š"></a>åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆdevåˆ†æ”¯ï¼‰ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -D dev</span><br></pre></td></tr></table></figure><h2 id="æ‹‰å–ä»£ç ï¼ˆæ‹‰å–æŒ‡å®šåˆ†æ”¯ï¼‰ï¼š"><a href="#æ‹‰å–ä»£ç ï¼ˆæ‹‰å–æŒ‡å®šåˆ†æ”¯ï¼‰ï¼š" class="headerlink" title="æ‹‰å–ä»£ç ï¼ˆæ‹‰å–æŒ‡å®šåˆ†æ”¯ï¼‰ï¼š"></a>æ‹‰å–ä»£ç ï¼ˆæ‹‰å–æŒ‡å®šåˆ†æ”¯ï¼‰ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt;</span><br></pre></td></tr></table></figure><h2 id="æ‹‰å–ä»£ç ï¼ˆä¸å½“å‰åˆ†æ”¯åˆå¹¶ï¼‰"><a href="#æ‹‰å–ä»£ç ï¼ˆä¸å½“å‰åˆ†æ”¯åˆå¹¶ï¼‰" class="headerlink" title="æ‹‰å–ä»£ç ï¼ˆä¸å½“å‰åˆ†æ”¯åˆå¹¶ï¼‰:"></a>æ‹‰å–ä»£ç ï¼ˆä¸å½“å‰åˆ†æ”¯åˆå¹¶ï¼‰:</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;</span><br></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨åˆå¹¶ï¼ˆæ‰“å¼€mergeå·¥å…·ï¼‰-ï¼š"><a href="#æ‰‹åŠ¨åˆå¹¶ï¼ˆæ‰“å¼€mergeå·¥å…·ï¼‰-ï¼š" class="headerlink" title="æ‰‹åŠ¨åˆå¹¶ï¼ˆæ‰“å¼€mergeå·¥å…·ï¼‰  ï¼š"></a>æ‰‹åŠ¨åˆå¹¶ï¼ˆæ‰“å¼€mergeå·¥å…·ï¼‰  ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git merge tool </span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰“å¼€beyondcompareåå·¦è¾¹æ˜¯å½“å‰åˆ†æ”¯ä»£ç ï¼Œä¸­é—´æ˜¯ä¿®æ”¹å‰çš„ä»£ç ï¼Œå³è¾¹æ˜¯è¢«åˆå¹¶åˆ†æ”¯çš„ä»£ç ï¼Œç‚¹å‡»å·¦è¾¹ç®­å¤´è¿›è¡Œé€‰æ‹©å¹¶åˆå¹¶</span></span><br></pre></td></tr></table></figure><p><img src="/2021/02/13/tool_operation/git/clipboard.png" alt="img"></p><p><img src="/2021/02/13/tool_operation/git/category.jpg" alt="category"></p><p>åˆ é™¤è¿œç«¯æ–‡ä»¶ï¼ˆä¿ç•™æœ¬åœ°æ–‡ä»¶ï¼‰:</p><p>æ–‡ä»¶: git rm â€“cache filename</p><p>æ–‡ä»¶å¤¹: git rm -r â€“cache dirname</p><p>åˆ›å»ºå’Œåˆ é™¤æ ‡ç­¾ï¼š</p><p>åˆ›å»ºï¼šgit tag &lt;æ ‡ç­¾å&gt;</p><p>git push origin &lt;æ ‡ç­¾å&gt;</p><p>åˆ é™¤ï¼šgit tag -d &lt;æ ‡ç­¾å&gt;</p><p>git push origin :refs/tags/æ ‡ç­¾å</p><p><a href="https://blog.csdn.net/u010324331/article/details/89638643?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task">https://blog.csdn.net/u010324331/article/details/89638643?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</a></p><p>å°†tagæ£€å‡ºçš„åŠæ³•ï¼šgit checkout -b <new branch> <tag name></tag></new></p><p>è¿ç§»ä»“åº“ï¼ˆä»githubåˆ°gitee)</p><p><a href="https://blog.csdn.net/qq598535550/article/details/87870931">https://blog.csdn.net/qq598535550/article/details/87870931</a></p><p>git remote remove origin</p><p>git remote add origin <a href="https://gitee/com/Ztt./homework.git">https://gitee/com/Ztt./homework.git</a></p><p>git push -u origin master</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·æ“ä½œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…·æ“ä½œ </tag>
            
            <tag> ç‰ˆæœ¬ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®å¢å¼º</title>
      <link href="2021/02/12/cv/%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%E4%B8%8E%E8%AE%AD%E7%BB%83trick/"/>
      <url>2021/02/12/cv/%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%E4%B8%8E%E8%AE%AD%E7%BB%83trick/</url>
      
        <content type="html"><![CDATA[<h1 id="yolov5ä¸­ç”¨åˆ°çš„æ•°æ®å¢å¼ºå’Œtrickæ€»ç»“ï¼ˆä¸Šï¼‰"><a href="#yolov5ä¸­ç”¨åˆ°çš„æ•°æ®å¢å¼ºå’Œtrickæ€»ç»“ï¼ˆä¸Šï¼‰" class="headerlink" title="yolov5ä¸­ç”¨åˆ°çš„æ•°æ®å¢å¼ºå’Œtrickæ€»ç»“ï¼ˆä¸Šï¼‰"></a>yolov5ä¸­ç”¨åˆ°çš„æ•°æ®å¢å¼ºå’Œtrickæ€»ç»“ï¼ˆä¸Šï¼‰</h1><p>yolov5ä¸­ç”¨åˆ°äº†è®¸å¤šæ•°æ®å¢å¼ºæ–¹æ³•å’Œtrickæ¥æé«˜æ¨¡å‹ç²¾åº¦ï¼Œå¦‚mosaic, cutout, augment imagespace, augment colorspaceï¼Œaugment hsv, ç¿»è½¬ï¼Œæ—‹è½¬ç­‰</p><h2 id="æ•°æ®å¢å¼º"><a href="#æ•°æ®å¢å¼º" class="headerlink" title="æ•°æ®å¢å¼º"></a>æ•°æ®å¢å¼º</h2><h3 id="ä¸€ã€Mosaic"><a href="#ä¸€ã€Mosaic" class="headerlink" title="ä¸€ã€Mosaic"></a>ä¸€ã€Mosaic</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>Mosaicé€šè¿‡å°†å››å¼ è®­ç»ƒå›¾ç‰‡åˆå¹¶æˆä¸€å¼ ï¼Œç”±æ­¤å¯ä»¥æå‡æ¨¡å‹å¯¹å°ç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå°ç›®æ ‡å›¾ç‰‡åœ¨è®­ç»ƒé›†ä¸­çš„åˆ†å¸ƒå¹¶ä¸å‡åŒ€ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†æ¨¡å‹å¯¹å°æ ·æœ¬çš„å­¦ä¹ ä¸å¤Ÿå……åˆ†ï¼Œå› æ­¤åœ¨é€šè¿‡mosaicæ“ä½œåï¼Œä½¿å¾—æ•°æ®é›†ä¸­å°ç›®æ ‡æ ·æœ¬æ•°é‡å¾—ä»¥å¢åŠ ï¼Œæ¯å¼ å›¾éƒ½æœ‰ä¸åŒç¨‹åº¦çš„ç¼©å°ï¼Œå³ä½¿æ²¡æœ‰å°ç›®æ ‡ï¼Œé€šè¿‡ç¼©å°ï¼ŒåŸæ¥çš„ç›®æ ‡å°ºå¯¸ä¹Ÿæ›´æ¥è¿‘å°ç›®æ ‡çš„å¤§å°ã€‚</p><h4 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_mosaic</span>(<span class="params">self, index</span>):</span></span><br><span class="line">    <span class="comment"># loads images in a 4-mosaic</span></span><br><span class="line"><span class="comment"># å°†å››å¼ å›¾ç‰‡åˆå¹¶æˆä¸€å¼ å›¾ç‰‡</span></span><br><span class="line">    labels4 = []</span><br><span class="line">    s = self.img_size</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åœ¨å›¾ç‰‡ä¸­éšæœºé€‰å–ä¸€ä¸ªä¸­å¿ƒç‚¹ï¼Œä½œä¸ºå››å¼ å›¾ç‰‡æ‹¼æ¥çš„ä¸­å¿ƒç‚¹, self.mosaic_border = [-img_size // 2, img_size // 2]</span></span><br><span class="line">    yc, xc = [<span class="built_in">int</span>(random.uniform(-x, <span class="number">2</span> * s + x)) <span class="keyword">for</span> x <span class="keyword">in</span> self.mosaic_border]  <span class="comment"># mosaic center x, y</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#éšæœºæŒ‘é€‰ä¸‰å¼ è¢«é•¶åµŒå›¾ç‰‡ï¼Œé€šè¿‡indicesæ¥ç´¢å¼•</span></span><br><span class="line">    indices = [index] + [self. [random.randint(<span class="number">0</span>, self.n - <span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]  <span class="comment"># 3 additional image indices</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, index <span class="keyword">in</span> <span class="built_in">enumerate</span>(indices):</span><br><span class="line">        <span class="comment"># Load imageï¼Œè¿”å›å›¾ç‰‡çŸ©é˜µï¼Œå›¾ç‰‡å®½å’Œé«˜</span></span><br><span class="line">        img, _, (h, w) = load_image(self, index)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># place img in img4 å°†4å¼ å›¾ç‰‡åˆæˆä¸ºä¸€å¼ ï¼Œåˆ†åˆ«æ”¾åœ¨å›¾åƒçš„å››ä¸ªä½ç½®</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:  <span class="comment"># top left</span></span><br><span class="line">            img4 = np.full((s * <span class="number">2</span>, s * <span class="number">2</span>, img.shape[<span class="number">2</span>]), <span class="number">114</span>, dtype=np.uint8)  <span class="comment"># base image with 4 tiles</span></span><br><span class="line">            x1a, y1a, x2a, y2a = <span class="built_in">max</span>(xc - w, <span class="number">0</span>), <span class="built_in">max</span>(yc - h, <span class="number">0</span>), xc, yc  <span class="comment"># xmin, ymin, xmax, ymax (large image)</span></span><br><span class="line">            x1b, y1b, x2b, y2b = w - (x2a - x1a), h - (y2a - y1a), w, h  <span class="comment"># xmin, ymin, xmax, ymax (small image)</span></span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">1</span>:  <span class="comment"># top right</span></span><br><span class="line">            x1a, y1a, x2a, y2a = xc, <span class="built_in">max</span>(yc - h, <span class="number">0</span>), <span class="built_in">min</span>(xc + w, s * <span class="number">2</span>), yc</span><br><span class="line">            x1b, y1b, x2b, y2b = <span class="number">0</span>, h - (y2a - y1a), <span class="built_in">min</span>(w, x2a - x1a), h</span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">2</span>:  <span class="comment"># bottom left</span></span><br><span class="line">            x1a, y1a, x2a, y2a = <span class="built_in">max</span>(xc - w, <span class="number">0</span>), yc, xc, <span class="built_in">min</span>(s * <span class="number">2</span>, yc + h)</span><br><span class="line">            x1b, y1b, x2b, y2b = w - (x2a - x1a), <span class="number">0</span>, w, <span class="built_in">min</span>(y2a - y1a, h)</span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">3</span>:  <span class="comment"># bottom right</span></span><br><span class="line">            x1a, y1a, x2a, y2a = xc, yc, <span class="built_in">min</span>(xc + w, s * <span class="number">2</span>), <span class="built_in">min</span>(s * <span class="number">2</span>, yc + h)</span><br><span class="line">            x1b, y1b, x2b, y2b = <span class="number">0</span>, <span class="number">0</span>, <span class="built_in">min</span>(w, x2a - x1a), <span class="built_in">min</span>(y2a - y1a, h)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#æŠŠè¦åˆå¹¶å›¾ç‰‡æ”¾åˆ°å¤§çš„å›¾ç‰‡é‡Œ</span></span><br><span class="line">        img4[y1a:y2a, x1a:x2a] = img[y1b:y2b, x1b:x2b]  <span class="comment"># img4[ymin:ymax, xmin:xmax]</span></span><br><span class="line">        padw = x1a - x1b</span><br><span class="line">        padh = y1a - y1b</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Labels</span></span><br><span class="line">        labels = self.labels[index].copy()</span><br><span class="line">        <span class="keyword">if</span> labels.size:</span><br><span class="line">            <span class="comment"># å°†labelä»x, y, w, hè½¬æ¢æˆx1, y1, x2, y2</span></span><br><span class="line">            labels[:, <span class="number">1</span>:] = xywhn2xyxy(labels[:, <span class="number">1</span>:], w, h, padw, padh)  <span class="comment"># normalized xywh to pixel xyxy format</span></span><br><span class="line">        labels4.append(labels)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Concat/clip labels</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(labels4):</span><br><span class="line">        <span class="comment"># æŠŠå››å¼ å›¾ç‰‡çš„labelè¿›è¡Œåˆå¹¶</span></span><br><span class="line">        labels4 = np.concatenate(labels4, <span class="number">0</span>)</span><br><span class="line">        np.clip(labels4[:, <span class="number">1</span>:], <span class="number">0</span>, <span class="number">2</span> * s, out=labels4[:, <span class="number">1</span>:])  <span class="comment"># use with random_perspective</span></span><br><span class="line">        <span class="comment"># img4, labels4 = replicate(img4, labels4)  # replicate</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Augment  å¯¹å›¾ç‰‡åšä»¿å°„å˜æ¢æˆ–é€è§†å˜æ¢ï¼Œç”±self.hyp[&#x27;perspective&#x27;]å†³å®š</span></span><br><span class="line">    img4, labels4 = random_perspective(img4, labels4,</span><br><span class="line">                                       degrees=self.hyp[<span class="string">&#x27;degrees&#x27;</span>],</span><br><span class="line">                                       translate=self.hyp[<span class="string">&#x27;translate&#x27;</span>],</span><br><span class="line">                                       scale=self.hyp[<span class="string">&#x27;scale&#x27;</span>],</span><br><span class="line">                                       shear=self.hyp[<span class="string">&#x27;shear&#x27;</span>],</span><br><span class="line">                                       perspective=self.hyp[<span class="string">&#x27;perspective&#x27;</span>],</span><br><span class="line">                                       border=self.mosaic_border)  <span class="comment"># border to remove</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> img4, labels4</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="äºŒã€letterbox"><a href="#äºŒã€letterbox" class="headerlink" title="äºŒã€letterbox"></a>äºŒã€letterbox</h3><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¨¡å‹çš„è¾“å…¥å°ºå¯¸éƒ½æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œå¦‚yolov5ä¸ºï¼ˆ640ï¼Œ640ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè®­ç»ƒé›†å›¾ç‰‡çš„å¤§å°éƒ½æ˜¯ä¸åŒçš„ï¼Œå› æ­¤éœ€è¦å¯¹å›¾ç‰‡çš„å°ºå¯¸è¿›è¡Œç»Ÿä¸€ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬é©¬ä¸Šä¼šæƒ³åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œcv2.resize()ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå®ƒä¼šç ´åå›¾ç‰‡çš„çºµæ¨ªæ¯”ï¼ˆaspect ratioï¼‰ï¼Œå¦‚æœå›¾ç‰‡çš„é•¿å’Œå®½ä¸ä¸ç›®æ ‡å°ºå¯¸æˆç›¸åŒæ¯”ä¾‹ï¼Œé‚£ä¹ˆå›¾ç‰‡å°±ä¼šå¤±çœŸï¼Œç»“æœå°±æ˜¯æˆ‘ä»¬çš„æ¨¡å‹ç²¾åº¦ä¼šæ”¶åˆ°å½±å“ã€‚è€Œletterboxå°±æ˜¯åœ¨ä¿æŒçºµæ¨ªæ¯”çš„å‰æä¸‹å¯¹å›¾åƒåšresizeï¼Œå…ˆresizeç„¶åæŒ‰éœ€è¦åœ¨å‘¨å›´padä¸Š0åƒç´ ã€‚è¯´ç™½äº†å°±æ˜¯å…ˆæŒ‰ç…§æ¯”ä¾‹resizeåˆ°ä¸€ä¸ªä¸ç›®æ ‡å°ºå¯¸ç›¸è¿‘çš„å¤§å°ï¼Œç„¶åé€šè¿‡padå°†å›¾ç‰‡å¡«å……åˆ°ç›®æ ‡å°ºå¯¸ã€‚</p><h4 id="ä»£ç åˆ†æ-1"><a href="#ä»£ç åˆ†æ-1" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">letterbox</span>(<span class="params">img, new_shape=(<span class="params"><span class="number">640</span>, <span class="number">640</span></span>), color=(<span class="params"><span class="number">114</span>, <span class="number">114</span>, <span class="number">114</span></span>), auto=<span class="literal">True</span>, scaleFill=<span class="literal">False</span>, scaleup=<span class="literal">True</span>, stride=<span class="number">32</span></span>):</span></span><br><span class="line">    <span class="comment"># Resize and pad image while meeting stride-multiple constraints</span></span><br><span class="line">    shape = img.shape[:<span class="number">2</span>]  <span class="comment"># current shape [height, width]</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(new_shape, <span class="built_in">int</span>):</span><br><span class="line">        new_shape = (new_shape, new_shape)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Scale ratio (new / old)</span></span><br><span class="line">    <span class="comment"># è®¡ç®—éœ€è¦resizeçš„æ¯”ä¾‹ï¼Œå–åŸå§‹å›¾ç‰‡å¤§å°ä¸ç›®æ ‡å°ºå¯¸é•¿å®½æ¯”å€¼é‡Œè¾ƒå°çš„ä¸€ä¸ª</span></span><br><span class="line">    r = <span class="built_in">min</span>(new_shape[<span class="number">0</span>] / shape[<span class="number">0</span>], new_shape[<span class="number">1</span>] / shape[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># å¦‚æœåœ¨æµ‹è¯•çš„æ—¶å€™åŸå§‹å›¾ç‰‡å°ºå¯¸å°äºç›®æ ‡å°ºå¯¸ï¼Œåˆ™è¿›è¡Œç­‰æ¯”ä¾‹å˜æ¢ï¼Œè¿™æ˜¯ä¸ºäº†å¾—åˆ°æ›´é«˜çš„map</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> scaleup:  <span class="comment"># only scale down, do not scale up (for better test mAP)</span></span><br><span class="line">        r = <span class="built_in">min</span>(r, <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Compute padding</span></span><br><span class="line">    ratio = r, r  <span class="comment"># width, height ratios</span></span><br><span class="line">    <span class="comment"># è®¡ç®—æ–°å›¾ç‰‡æŒ‰æ¯”ä¾‹resizeçš„å¤§å°</span></span><br><span class="line">    new_unpad = <span class="built_in">int</span>(<span class="built_in">round</span>(shape[<span class="number">1</span>] * r)), <span class="built_in">int</span>(<span class="built_in">round</span>(shape[<span class="number">0</span>] * r))</span><br><span class="line">    <span class="comment"># è®¡ç®—é•¿å’Œå®½åˆ†åˆ«æœ‰å¤šå°‘åƒç´ éœ€è¦å¡«å……</span></span><br><span class="line">    dw, dh = new_shape[<span class="number">1</span>] - new_unpad[<span class="number">0</span>], new_shape[<span class="number">0</span>] - new_unpad[<span class="number">1</span>]  <span class="comment"># wh padding</span></span><br><span class="line">    <span class="keyword">if</span> auto:  <span class="comment"># minimum rectangle</span></span><br><span class="line">        dw, dh = np.mod(dw, stride), np.mod(dh, stride)  <span class="comment"># wh padding</span></span><br><span class="line">    <span class="keyword">elif</span> scaleFill:  <span class="comment"># stretch</span></span><br><span class="line">        dw, dh = <span class="number">0.0</span>, <span class="number">0.0</span></span><br><span class="line">        new_unpad = (new_shape[<span class="number">1</span>], new_shape[<span class="number">0</span>])</span><br><span class="line">       <span class="comment"># è®¡ç®—åŸå§‹å›¾ç‰‡å°ºå¯¸ä¸ç›®æ ‡å°ºå¯¸çš„çºµæ¨ªæ¯”</span></span><br><span class="line">        ratio = new_shape[<span class="number">1</span>] / shape[<span class="number">1</span>], new_shape[<span class="number">0</span>] / shape[<span class="number">0</span>]  <span class="comment"># width, height ratios</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†é•¿å’Œå®½åˆ†åˆ«åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œé•¿åˆ†æˆå·¦å³å¡«å……åˆ°å›¾ç‰‡ä¸­ï¼Œå®½åˆ†æˆä¸Šå’Œä¸‹å¡«å……åˆ°å›¾ç‰‡ä¸­</span></span><br><span class="line">    dw /= <span class="number">2</span>  <span class="comment"># divide padding into 2 sides</span></span><br><span class="line">    dh /= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> shape[::-<span class="number">1</span>] != new_unpad:  <span class="comment"># resize</span></span><br><span class="line">        img = cv2.resize(img, new_unpad, interpolation=cv2.INTER_LINEAR)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¯¹å¡«å……å¤§å°å››èˆäº”å…¥å–æ•´</span></span><br><span class="line">    top, bottom = <span class="built_in">int</span>(<span class="built_in">round</span>(dh - <span class="number">0.1</span>)), <span class="built_in">int</span>(<span class="built_in">round</span>(dh + <span class="number">0.1</span>))</span><br><span class="line">    left, right = <span class="built_in">int</span>(<span class="built_in">round</span>(dw - <span class="number">0.1</span>)), <span class="built_in">int</span>(<span class="built_in">round</span>(dw + <span class="number">0.1</span>))</span><br><span class="line">    <span class="comment"># å¡«å……åƒç´ </span></span><br><span class="line">    img = cv2.copyMakeBorder(img, top, bottom, left, right, cv2.BORDER_CONSTANT, value=color)  <span class="comment"># add border</span></span><br><span class="line">    <span class="keyword">return</span> img, ratio, (dw, dh)</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€augment-hsv"><a href="#ä¸‰ã€augment-hsv" class="headerlink" title="ä¸‰ã€augment_hsv"></a>ä¸‰ã€augment_hsv</h3><p>å¯¹hsvè‰²å½©ç©ºé—´è¿›è¡Œå¢å¼º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">r = np.random.uniform(-<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>) * [hgain, sgain, vgain] + <span class="number">1</span>  <span class="comment"># random gains</span></span><br><span class="line">   hue, sat, val = cv2.split(cv2.cvtColor(img, cv2.COLOR_BGR2HSV))</span><br><span class="line">   dtype = img.dtype  <span class="comment"># uint8</span></span><br><span class="line"></span><br><span class="line">   x = np.arange(<span class="number">0</span>, <span class="number">256</span>, dtype=np.int16)</span><br><span class="line">   lut_hue = ((x * r[<span class="number">0</span>]) % <span class="number">180</span>).astype(dtype)</span><br><span class="line">   lut_sat = np.clip(x * r[<span class="number">1</span>], <span class="number">0</span>, <span class="number">255</span>).astype(dtype)</span><br><span class="line">   lut_val = np.clip(x * r[<span class="number">2</span>], <span class="number">0</span>, <span class="number">255</span>).astype(dtype)</span><br><span class="line"></span><br><span class="line">   img_hsv = cv2.merge((cv2.LUT(hue, lut_hue), cv2.LUT(sat, lut_sat), cv2.LUT(val, lut_val))).astype(dtype)</span><br><span class="line">   cv2.cvtColor(img_hsv, cv2.COLOR_HSV2BGR, dst=img)  <span class="comment"># no return needed</span></span><br></pre></td></tr></table></figure><h3 id="å››ã€cutout"><a href="#å››ã€cutout" class="headerlink" title="å››ã€cutout"></a>å››ã€cutout</h3><p>å¯¹æ ·æœ¬çš„éšæœºåŒºåŸŸè¿›è¡Œæ“¦é™¤ï¼Œå¹¶å¡«å……0åƒç´ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cutout</span>(<span class="params">image, labels</span>):</span></span><br><span class="line">    <span class="comment"># Applies image cutout augmentation https://arxiv.org/abs/1708.04552</span></span><br><span class="line">    h, w = image.shape[:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bbox_ioa</span>(<span class="params">box1, box2</span>):</span></span><br><span class="line">        <span class="comment"># Returns the intersection over box2 area given box1, box2. box1 is 4, box2 is nx4. boxes are x1y1x2y2</span></span><br><span class="line">        box2 = box2.transpose()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get the coordinates of bounding boxes</span></span><br><span class="line">        b1_x1, b1_y1, b1_x2, b1_y2 = box1[<span class="number">0</span>], box1[<span class="number">1</span>], box1[<span class="number">2</span>], box1[<span class="number">3</span>]</span><br><span class="line">        b2_x1, b2_y1, b2_x2, b2_y2 = box2[<span class="number">0</span>], box2[<span class="number">1</span>], box2[<span class="number">2</span>], box2[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Intersection area</span></span><br><span class="line">        inter_area = (np.minimum(b1_x2, b2_x2) - np.maximum(b1_x1, b2_x1)).clip(<span class="number">0</span>) * \</span><br><span class="line">                     (np.minimum(b1_y2, b2_y2) - np.maximum(b1_y1, b2_y1)).clip(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># box2 area</span></span><br><span class="line">        box2_area = (b2_x2 - b2_x1) * (b2_y2 - b2_y1) + <span class="number">1e-16</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Intersection over box2 area</span></span><br><span class="line">        <span class="keyword">return</span> inter_area / box2_area</span><br><span class="line"></span><br><span class="line">    <span class="comment"># create random masks</span></span><br><span class="line">    scales = [<span class="number">0.5</span>] * <span class="number">1</span> + [<span class="number">0.25</span>] * <span class="number">2</span> + [<span class="number">0.125</span>] * <span class="number">4</span> + [<span class="number">0.0625</span>] * <span class="number">8</span> + [<span class="number">0.03125</span>] * <span class="number">16</span>  <span class="comment"># image size fraction</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> scales:</span><br><span class="line">        mask_h = random.randint(<span class="number">1</span>, <span class="built_in">int</span>(h * s))</span><br><span class="line">        mask_w = random.randint(<span class="number">1</span>, <span class="built_in">int</span>(w * s))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># box</span></span><br><span class="line">        xmin = <span class="built_in">max</span>(<span class="number">0</span>, random.randint(<span class="number">0</span>, w) - mask_w // <span class="number">2</span>)</span><br><span class="line">        ymin = <span class="built_in">max</span>(<span class="number">0</span>, random.randint(<span class="number">0</span>, h) - mask_h // <span class="number">2</span>)</span><br><span class="line">        xmax = <span class="built_in">min</span>(w, xmin + mask_w)</span><br><span class="line">        ymax = <span class="built_in">min</span>(h, ymin + mask_h)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># apply random color mask</span></span><br><span class="line">        image[ymin:ymax, xmin:xmax] = [random.randint(<span class="number">64</span>, <span class="number">191</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># return unobscured labels</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(labels) <span class="keyword">and</span> s &gt; <span class="number">0.03</span>:</span><br><span class="line">            box = np.array([xmin, ymin, xmax, ymax], dtype=np.float32)</span><br><span class="line">            ioa = bbox_ioa(box, labels[:, <span class="number">1</span>:<span class="number">5</span>])  <span class="comment"># intersection over area</span></span><br><span class="line">            labels = labels[ioa &lt; <span class="number">0.60</span>]  <span class="comment"># remove &gt;60% obscured labels</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> labels</span><br></pre></td></tr></table></figure><h3 id="äº”ã€éšæœºæ°´å¹³ç¿»è½¬å’Œå‚ç›´ç¿»è½¬"><a href="#äº”ã€éšæœºæ°´å¹³ç¿»è½¬å’Œå‚ç›´ç¿»è½¬" class="headerlink" title="äº”ã€éšæœºæ°´å¹³ç¿»è½¬å’Œå‚ç›´ç¿»è½¬"></a>äº”ã€éšæœºæ°´å¹³ç¿»è½¬å’Œå‚ç›´ç¿»è½¬</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> self.augment:</span><br><span class="line">    <span class="comment"># flip up-down</span></span><br><span class="line">    <span class="keyword">if</span> random.random() &lt; hyp[<span class="string">&#x27;flipud&#x27;</span>]:</span><br><span class="line">        img = np.flipud(img)</span><br><span class="line">        <span class="keyword">if</span> nL:</span><br><span class="line">            labels[:, <span class="number">2</span>] = <span class="number">1</span> - labels[:, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># flip left-right</span></span><br><span class="line">    <span class="keyword">if</span> random.random() &lt; hyp[<span class="string">&#x27;fliplr&#x27;</span>]:</span><br><span class="line">        img = np.fliplr(img)</span><br><span class="line">        <span class="keyword">if</span> nL:</span><br><span class="line">            labels[:, <span class="number">1</span>] = <span class="number">1</span> - labels[:, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">labels_out = torch.zeros((nL, <span class="number">6</span>))     </span><br></pre></td></tr></table></figure><h3 id="å…­ã€éšæœºä»¿å°„å˜æ¢"><a href="#å…­ã€éšæœºä»¿å°„å˜æ¢" class="headerlink" title="å…­ã€éšæœºä»¿å°„å˜æ¢"></a>å…­ã€éšæœºä»¿å°„å˜æ¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_perspective</span>(<span class="params">img, targets=(<span class="params"></span>), degrees=<span class="number">10</span>, translate=<span class="number">.1</span>, scale=<span class="number">.1</span>, shear=<span class="number">10</span>, perspective=<span class="number">0.0</span>, border=(<span class="params"><span class="number">0</span>, <span class="number">0</span></span>)</span>):</span></span><br><span class="line">    <span class="comment"># torchvision.transforms.RandomAffine(degrees=(-10, 10), translate=(.1, .1), scale=(.9, 1.1), shear=(-10, 10))</span></span><br><span class="line">    <span class="comment"># targets = [cls, xyxy]</span></span><br><span class="line"></span><br><span class="line">    height = img.shape[<span class="number">0</span>] + border[<span class="number">0</span>] * <span class="number">2</span>  <span class="comment"># shape(h,w,c)</span></span><br><span class="line">    width = img.shape[<span class="number">1</span>] + border[<span class="number">1</span>] * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Center</span></span><br><span class="line">    C = np.eye(<span class="number">3</span>)</span><br><span class="line">    C[<span class="number">0</span>, <span class="number">2</span>] = -img.shape[<span class="number">1</span>] / <span class="number">2</span>  <span class="comment"># x translation (pixels)</span></span><br><span class="line">    C[<span class="number">1</span>, <span class="number">2</span>] = -img.shape[<span class="number">0</span>] / <span class="number">2</span>  <span class="comment"># y translation (pixels)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Perspective</span></span><br><span class="line">    P = np.eye(<span class="number">3</span>)</span><br><span class="line">    P[<span class="number">2</span>, <span class="number">0</span>] = random.uniform(-perspective, perspective)  <span class="comment"># x perspective (about y)</span></span><br><span class="line">    P[<span class="number">2</span>, <span class="number">1</span>] = random.uniform(-perspective, perspective)  <span class="comment"># y perspective (about x)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Rotation and Scale</span></span><br><span class="line">    R = np.eye(<span class="number">3</span>)</span><br><span class="line">    a = random.uniform(-degrees, degrees)</span><br><span class="line">    <span class="comment"># a += random.choice([-180, -90, 0, 90])  # add 90deg rotations to small rotations</span></span><br><span class="line">    s = random.uniform(<span class="number">1</span> - scale, <span class="number">1</span> + scale)</span><br><span class="line">    <span class="comment"># s = 2 ** random.uniform(-scale, scale)</span></span><br><span class="line">    R[:<span class="number">2</span>] = cv2.getRotationMatrix2D(angle=a, center=(<span class="number">0</span>, <span class="number">0</span>), scale=s)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Shear</span></span><br><span class="line">    S = np.eye(<span class="number">3</span>)</span><br><span class="line">    S[<span class="number">0</span>, <span class="number">1</span>] = math.tan(random.uniform(-shear, shear) * math.pi / <span class="number">180</span>)  <span class="comment"># x shear (deg)</span></span><br><span class="line">    S[<span class="number">1</span>, <span class="number">0</span>] = math.tan(random.uniform(-shear, shear) * math.pi / <span class="number">180</span>)  <span class="comment"># y shear (deg)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Translation</span></span><br><span class="line">    T = np.eye(<span class="number">3</span>)</span><br><span class="line">    T[<span class="number">0</span>, <span class="number">2</span>] = random.uniform(<span class="number">0.5</span> - translate, <span class="number">0.5</span> + translate) * width  <span class="comment"># x translation (pixels)</span></span><br><span class="line">    T[<span class="number">1</span>, <span class="number">2</span>] = random.uniform(<span class="number">0.5</span> - translate, <span class="number">0.5</span> + translate) * height  <span class="comment"># y translation (pixels)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Combined rotation matrix</span></span><br><span class="line">    M = T @ S @ R @ P @ C  <span class="comment"># order of operations (right to left) is IMPORTANT</span></span><br><span class="line">    <span class="keyword">if</span> (border[<span class="number">0</span>] != <span class="number">0</span>) <span class="keyword">or</span> (border[<span class="number">1</span>] != <span class="number">0</span>) <span class="keyword">or</span> (M != np.eye(<span class="number">3</span>)).<span class="built_in">any</span>():  <span class="comment"># image changed</span></span><br><span class="line">        <span class="keyword">if</span> perspective:</span><br><span class="line">            img = cv2.warpPerspective(img, M, dsize=(width, height), borderValue=(<span class="number">114</span>, <span class="number">114</span>, <span class="number">114</span>))</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># affine</span></span><br><span class="line">            img = cv2.warpAffine(img, M[:<span class="number">2</span>], dsize=(width, height), borderValue=(<span class="number">114</span>, <span class="number">114</span>, <span class="number">114</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Visualize</span></span><br><span class="line">    <span class="comment"># import matplotlib.pyplot as plt</span></span><br><span class="line">    <span class="comment"># ax = plt.subplots(1, 2, figsize=(12, 6))[1].ravel()</span></span><br><span class="line">    <span class="comment"># ax[0].imshow(img[:, :, ::-1])  # base</span></span><br><span class="line">    <span class="comment"># ax[1].imshow(img2[:, :, ::-1])  # warped</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Transform labels coordinates</span></span><br><span class="line">    n = <span class="built_in">len</span>(targets)</span><br><span class="line">    <span class="keyword">if</span> n:</span><br><span class="line">        <span class="comment"># warp points</span></span><br><span class="line">        xy = np.ones((n * <span class="number">4</span>, <span class="number">3</span>))</span><br><span class="line">        xy[:, :<span class="number">2</span>] = targets[:, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>]].reshape(n * <span class="number">4</span>, <span class="number">2</span>)  <span class="comment"># x1y1, x2y2, x1y2, x2y1</span></span><br><span class="line">        xy = xy @ M.T  <span class="comment"># transform</span></span><br><span class="line">        <span class="keyword">if</span> perspective:</span><br><span class="line">            xy = (xy[:, :<span class="number">2</span>] / xy[:, <span class="number">2</span>:<span class="number">3</span>]).reshape(n, <span class="number">8</span>)  <span class="comment"># rescale</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># affine</span></span><br><span class="line">            xy = xy[:, :<span class="number">2</span>].reshape(n, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create new boxes</span></span><br><span class="line">        x = xy[:, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]]</span><br><span class="line">        y = xy[:, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>]]</span><br><span class="line">        xy = np.concatenate((x.<span class="built_in">min</span>(<span class="number">1</span>), y.<span class="built_in">min</span>(<span class="number">1</span>), x.<span class="built_in">max</span>(<span class="number">1</span>), y.<span class="built_in">max</span>(<span class="number">1</span>))).reshape(<span class="number">4</span>, n).T</span><br><span class="line"></span><br><span class="line">        <span class="comment"># # apply angle-based reduction of bounding boxes</span></span><br><span class="line">        <span class="comment"># radians = a * math.pi / 180</span></span><br><span class="line">        <span class="comment"># reduction = max(abs(math.sin(radians)), abs(math.cos(radians))) ** 0.5</span></span><br><span class="line">        <span class="comment"># x = (xy[:, 2] + xy[:, 0]) / 2</span></span><br><span class="line">        <span class="comment"># y = (xy[:, 3] + xy[:, 1]) / 2</span></span><br><span class="line">        <span class="comment"># w = (xy[:, 2] - xy[:, 0]) * reduction</span></span><br><span class="line">        <span class="comment"># h = (xy[:, 3] - xy[:, 1]) * reduction</span></span><br><span class="line">        <span class="comment"># xy = np.concatenate((x - w / 2, y - h / 2, x + w / 2, y + h / 2)).reshape(4, n).T</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># clip boxes</span></span><br><span class="line">        xy[:, [<span class="number">0</span>, <span class="number">2</span>]] = xy[:, [<span class="number">0</span>, <span class="number">2</span>]].clip(<span class="number">0</span>, width)</span><br><span class="line">        xy[:, [<span class="number">1</span>, <span class="number">3</span>]] = xy[:, [<span class="number">1</span>, <span class="number">3</span>]].clip(<span class="number">0</span>, height)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># filter candidates</span></span><br><span class="line">        i = box_candidates(box1=targets[:, <span class="number">1</span>:<span class="number">5</span>].T * s, box2=xy.T)</span><br><span class="line">        targets = targets[i]</span><br><span class="line">        targets[:, <span class="number">1</span>:<span class="number">5</span>] = xy[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> img, targets</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a href="https://zhuanlan.zhihu.com/p/93822508">https://zhuanlan.zhihu.com/p/93822508</a></p>]]></content>
      
      
      <categories>
          
          <category> Computer Vision </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Computer Vision </tag>
            
            <tag> Deep Learning </tag>
            
            <tag> Data Augmentation </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
